### <a name="currentculture-is-not-preserved-across-wpf-dispatcher-operations"></a><span data-ttu-id="06971-101">CurrentCulture 不會在 WPF 發送器作業之間保留</span><span class="sxs-lookup"><span data-stu-id="06971-101">CurrentCulture is not preserved across WPF Dispatcher operations</span></span>

|   |   |
|---|---|
|<span data-ttu-id="06971-102">詳細資料</span><span class="sxs-lookup"><span data-stu-id="06971-102">Details</span></span>|<span data-ttu-id="06971-103">從.NET Framework 4.6 開始，變成<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>或<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>內進行<xref:System.Windows.Threading.Dispatcher?displayProperty=name>將會遺失該發送器作業結尾處。</span><span class="sxs-lookup"><span data-stu-id="06971-103">Beginning in the .NET Framework 4.6, changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> made within a <xref:System.Windows.Threading.Dispatcher?displayProperty=name> will be lost at the end of that dispatcher operation.</span></span> <span data-ttu-id="06971-104">同樣地，若要變更<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>或<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>以外的發送器進行作業可能不會反映當作業執行。幾乎而言，這表示<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>和<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>變更可能不會 WPF UI 回呼和其他程式碼，在 WPF 應用程式之間流動。這是因為變更<xref:System.Threading.ExecutionContext?displayProperty=name>，進而導致<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>和<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>與以.NET Framework 4.6 為目標的應用程式儲存在執行內容的開頭。</span><span class="sxs-lookup"><span data-stu-id="06971-104">Similarly, changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> made outside of a Dispatcher operation may not be reflected when that operation executes.Practically speaking, this means that <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> changes may not flow between WPF UI callbacks and other code in a WPF application.This is due to a change in <xref:System.Threading.ExecutionContext?displayProperty=name> that causes <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> to be stored in the execution context beginning with apps targeting the .NET Framework 4.6.</span></span> <span data-ttu-id="06971-105">WPF 發送器作業會儲存用來開始作業的執行內容，並在作業完成時還原先前的內容。</span><span class="sxs-lookup"><span data-stu-id="06971-105">WPF dispatcher operations store the execution context used to begin the operation and restore the previous context when the operation is completed.</span></span> <span data-ttu-id="06971-106">因為 <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> 和 <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> 現在是該內容的一部分，所以在發送器作業內對其進行的變更不會保留到作業外。</span><span class="sxs-lookup"><span data-stu-id="06971-106">Because <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> are now part of that context, changes to them within a dispatcher operation are not persisted outside of the operation.</span></span>|
|<span data-ttu-id="06971-107">建議</span><span class="sxs-lookup"><span data-stu-id="06971-107">Suggestion</span></span>|<span data-ttu-id="06971-108">此變更影響的應用程式可能以避免儲存想要的<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>或<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>欄位和簽入所有發送器作業主體 （包括 UI 事件回呼處理常式） 中的正確<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>和<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>設定。</span><span class="sxs-lookup"><span data-stu-id="06971-108">Apps affected by this change may work around it by storing the desired <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> in a field and checking in all Dispatcher operation bodies (including UI event callback handlers) that the correct <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> are set.</span></span> <span data-ttu-id="06971-109">或者，因為 ExecutionContext 變更基礎 WPF 這項變更只會影響以.NET Framework 4.6 或更新版本為目標的應用程式，這個符號可以避免將目標設為目標.NET Framework 4.6 或更新版本也可以搭配.NET Framework 4.5.2.Apps解決此藉由設定下列相容性參數：</span><span class="sxs-lookup"><span data-stu-id="06971-109">Alternatively, because the ExecutionContext change underlying this WPF change only affects apps targeting the .NET Framework 4.6 or newer, this break can be avoided by targeting the .NET Framework 4.5.2.Apps that target .NET Framework 4.6 or later can also work around this by setting the following compatibility switch:</span></span><pre><code>AppContext.SetSwitch(&quot;Switch.System.Globalization.NoAsyncCurrentCulture&quot;, true);&#13;&#10;</code></pre><span data-ttu-id="06971-110">Wpf 在.NET Framework 4.6.2 已修正此問題。</span><span class="sxs-lookup"><span data-stu-id="06971-110">This issue has been fixed by WPF in .NET Framework 4.6.2.</span></span> <span data-ttu-id="06971-111">它也已修正在.NET Framework 4.6，透過 4.6.1 [KB 3139549](https://support.microsoft.com/kb/3139549)。</span><span class="sxs-lookup"><span data-stu-id="06971-111">It has also been fixed in .NET Frameworks 4.6, 4.6.1 through [KB 3139549](https://support.microsoft.com/kb/3139549).</span></span> <span data-ttu-id="06971-112">目標為.NET 4.6 或更新版本的應用程式將自動取得正確的行為在 WPF 應用程式- <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> / <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>) 會在發送器作業之間保留。</span><span class="sxs-lookup"><span data-stu-id="06971-112">Applications targeting .NET 4.6 or later will automatically get the right behavior in WPF applications - <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>) would be preserved across Dispatcher operations.</span></span>|
|<span data-ttu-id="06971-113">範圍</span><span class="sxs-lookup"><span data-stu-id="06971-113">Scope</span></span>|<span data-ttu-id="06971-114">次要</span><span class="sxs-lookup"><span data-stu-id="06971-114">Minor</span></span>|
|<span data-ttu-id="06971-115">版本</span><span class="sxs-lookup"><span data-stu-id="06971-115">Version</span></span>|<span data-ttu-id="06971-116">4.6</span><span class="sxs-lookup"><span data-stu-id="06971-116">4.6</span></span>|
|<span data-ttu-id="06971-117">類型</span><span class="sxs-lookup"><span data-stu-id="06971-117">Type</span></span>|<span data-ttu-id="06971-118">正在重定目標</span><span class="sxs-lookup"><span data-stu-id="06971-118">Retargeting</span></span>|

